<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/JavaScript" src="/lib/jquery-3.6.0.min.js" ></script>
<script type="text/JavaScript" src="/lib/kakao.js" ></script>
<link rel="stylesheet" type="text/css" href="/css/style.css">

<script language="javascript">
function sendMessage(id) {
    if (confirm('메시지를 전송하겠습니까?')) {
      Kakao.API.request({
        url: '/v1/api/talk/friends/message/default/send',
        data: {
          receiver_uuids: [id],
          template_object: {
            object_type: 'feed',
            content: {
              title: '카카오 공유 제목',
              link: {
                mobile_web_url: 'https://studyingazae.tistory.com',
                web_url: 'https://studyingazae.tistory.com',
              },
            },
            social: {
              like_count: 286,
              comment_count: 45,
              shared_count: 845,
            },
            buttons: [
              {
                title: '웹으로 보기',
                link: {
                  mobile_web_url: 'https://studyingazae.tistory.com',
                  web_url: 'https://studyingazae.tistory.com',
                },
              },
              {
                title: '앱으로 보기',
                link: {
                  mobile_web_url: 'https://studyingazae.tistory.com',
                  web_url: 'https://studyingazae.tistory.com',
                },
              },
            ],
          },
        },
        success: function (res) {
          alert('메시지 전송이 완료되었습니다. \n' + JSON.stringify(res))
        },
        fail: function (err) {
          alert('메시지 전송에 실패했습니다. \n' + JSON.stringify(err))
        },
      })
    }
  }
  function getFriends() {
    document.getElementById('friend-list').innerHTML = '';
    Kakao.Auth.login({
      scope: 'friends,talk_message',
      success: function (res) {
        Kakao.API.request({
          url: '/v1/api/talk/friends',
          success: function (res) {
            if (res.elements.length > 0) {
              for (let i = 0, item; (item = res.elements[i]); i++) {
                const friendElement = document.createElement('li')
                const profileImg = item.profile_thumbnail_image
                  ? item.profile_thumbnail_image
                  : 'http://k.kakaocdn.net/dn/1xGCm/btqwLTjcNzV/orvxGiWth8JR20SgUcDNKK/kakaolink40_original.jpg'

                friendElement.innerHTML = '<div class="friend">'
                  + '<img src="' + profileImg + '" alt="프로필 이미지">'
                  + '<strong>' + item.profile_nickname + '</strong>'
                  + '</div>'
                  + '<button onclick="sendMessage(\'' + item.uuid + '\')">전송</button>'
                document
                  .getElementById('friend-list')
                  .appendChild(friendElement)
              }
            } else {
              document.getElementById('friend-list').innerHTML =
                '앱에 연결된 친구가 없습니다. 앱에 연결된 친구만 조회할 수 있습니다.'
            }
          },
          fail: function (err) {
            document.getElementById('friend-list').innerHTML = JSON.stringify(err)
          },
        })
      },
    })
  }
	
Kakao.Link.createDefaultButton({
  container: '#kakao-link-btn',
  objectType: 'text',
  text:
    '기본 템플릿으로 제공되는 텍스트 템플릿은 텍스트를 최대 200자까지 표시할 수 있습니다. 텍스트 템플릿은 텍스트 영역과 하나의 기본 버튼을 가집니다. 임의의 버튼을 설정할 수도 있습니다. 여러 장의 이미지, 프로필 정보 등 보다 확장된 형태의 카카오링크는 다른 템플릿을 이용해 보낼 수 있습니다.',
  link: {
    mobileWebUrl:
      'https://developers.kakao.com',
    webUrl:
      'https://developers.kakao.com',
  },
});
</script>
<title>카카오톡 공유하기 버튼</title>
</head>
<body>
<div class="wrapper">
<form name="form" id="form" method="post" onsubmit="return false;">
	<input type="button" onClick="getFriends();" value="카카오 친구 공유" class="btn-kko"/>
</form>
<ul id="friend-list"></ul>
</div>
</body>
</html>
