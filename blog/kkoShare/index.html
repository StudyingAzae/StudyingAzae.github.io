<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script type="text/JavaScript" src="/lib/jquery-3.6.0.min.js" ></script>
<script type="text/JavaScript" src="/lib/kakao.js" ></script>
<link rel="stylesheet" type="text/css" href="/css/style.css">

<script language="javascript">
function sendMessage(id) {
    if (confirm('메시지를 전송하겠습니까?')) {
      Kakao.API.request({
        url: '/v1/api/talk/friends/message/default/send',
        data: {
          receiver_uuids: [id],
          template_object: {
            object_type: 'feed',
            content: {
              title: '카카오 공유 제목',
              link: {
                mobile_web_url: 'https://studyingazae.tistory.com',
                web_url: 'https://studyingazae.tistory.com',
              },
            },
            social: {
              like_count: 286,
              comment_count: 45,
              shared_count: 845,
            },
            buttons: [
              {
                title: '웹으로 보기',
                link: {
                  mobile_web_url: 'https://studyingazae.tistory.com',
                  web_url: 'https://studyingazae.tistory.com',
                },
              },
              {
                title: '앱으로 보기',
                link: {
                  mobile_web_url: 'https://studyingazae.tistory.com',
                  web_url: 'https://studyingazae.tistory.com',
                },
              },
            ],
          },
        },
        success: function (res) {
          alert('메시지 전송이 완료되었습니다. \n' + JSON.stringify(res))
        },
        fail: function (err) {
          alert('메시지 전송에 실패했습니다. \n' + JSON.stringify(err))
        },
      })
    }
  }
  function getFriends() {
    document.getElementById('friend-list').innerHTML = ''
    Kakao.Auth.login({
      scope: 'friends,talk_message',
      success: function (res) {
        Kakao.API.request({
          url: '/v1/api/talk/friends',
          success: function (res) {
            if (res.elements.length > 0) {
              for (let i = 0, item; (item = res.elements[i]); i++) {
                const friendElement = document.createElement('li')
                const profileImg = item.profile_thumbnail_image
                  ? item.profile_thumbnail_image
                  : 'http://k.kakaocdn.net/dn/1xGCm/btqwLTjcNzV/orvxGiWth8JR20SgUcDNKK/kakaolink40_original.jpg'

                friendElement.innerHTML = '<div class="friend">'
                  + '<img src="' + profileImg + '" alt="프로필 이미지">'
                  + '<strong>' + item.profile_nickname + '</strong>'
                  + '</div>'
                  + '<button onclick="sendMessage(\'' + item.uuid + '\')">전송</button>'
                document
                  .getElementById('friend-list')
                  .appendChild(friendElement)
              }
            } else {
              document.getElementById('friend-list').innerHTML =
                '앱에 연결된 친구가 없습니다. 앱에 연결된 친구만 조회할 수 있습니다.'
            }
          },
          fail: function (err) {
            document.getElementById('friend-list').innerHTML = JSON.stringify(err)
          },
        })
      },
    })
  }
</script>
<title>카카오톡 공유하기 버튼</title>
</head>
<body>
<div class="wrapper">
<form name="form" id="form" method="post" onsubmit="return false;">
	<input type="button" onClick="getFriends();" value="카카오 친구 공유" class="btn-kko"/>
</form>
<ul id="friend-list"></ul>
</div>
</body>
</html>
